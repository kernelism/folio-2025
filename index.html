<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Arjhun Sreedar</title>
  <link rel="stylesheet" type="text/css" href="./styles/styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
  <button class="info-toggle" id="infoToggle" aria-label="Last updated info">
    <span class="info-icon">i</span>
    <div class="info-tooltip">
      <span class="info-tooltiptext" id="lastUpdated"></span>
    </div>
  </button>

  <div id="dhead" class="container">
    <div class="row">
      <div id="dpic">
        <img src="" class="ppic" id="profileImage" />
      </div>
      <div id="ddesc">
        <h1 id="userName"></h1>
        <h2 id="userTagline"></h2>
        <div id="dico"></div>
      </div>
    </div>
  </div>

  <hr>

  <div id="bio" class="container" style="display:none;">
  </div>

  <div id="about" class="container">
    <div class="ctitle" id="aboutTitle"></div>
    <div class="about-content" id="aboutContent"></div>
  </div>

  <div id="history" class="container"></div>

  <div class="writing-section">
    <div class="container" id="writingContainer"></div>
  </div>

  <div id="pet-projects" class="container"></div>

  <div class="container" id="publicationsContainer"></div>

  <div class="container" id="miscContainer"></div>

  <div id="contact" class="container">
    <div class="ctitle" id="contactTitle"></div>
    <div class="contact-content">
      <p id="contactDescription"></p>
      <form id="contactForm" class="contact-form">
        <input type="text" id="name" placeholder="" required />
        <input type="email" id="email" placeholder="" required />
        <textarea id="message" placeholder="" rows="4" required></textarea>
        <button type="submit" id="submitBtn"></button>
      </form>
      <div id="formStatus" style="display: none; margin-top: 10px;"></div>
    </div>
  </div>

  <br><br><br><br>

  <script type="text/javascript">
    let siteContent = null;

    async function loadContent() {
      try {
        const response = await fetch('./content/content.json');
        siteContent = await response.json();
        populateContent();
      } catch (error) {
        console.error('Failed to load content:', error);
      }
    }

    function populateContent() {
      if (!siteContent) return;

      document.getElementById('profileImage').src = siteContent.header.profileImage;
      document.getElementById('userName').textContent = siteContent.header.name;

      document.getElementById('userTagline').textContent = siteContent.header.tagline;
      
      const socialLinks = document.getElementById('dico');
      socialLinks.innerHTML = siteContent.header.socialLinks.map(link => 
        `<a href="${link.url}"><i class="${link.icon}"></i></a>`
      ).join('');

      document.getElementById('lastUpdated').textContent = `Last updated: ${siteContent.info.lastUpdated}`;

      document.getElementById('aboutTitle').textContent = siteContent.about.title;
      document.getElementById('aboutContent').innerHTML = siteContent.about.paragraphs.map(p => 
        `<p>${p}</p>`
      ).join('');

      const historyContainer = document.getElementById('history');
      historyContainer.innerHTML = siteContent.history.entries.map(entry => `
        <div class="entry row">
          <div class="timespan">${entry.timespan}</div>
          <div class="ico">
            <div class="entry-dot"></div>
            <img src="${entry.logo}" />
          </div>
          <div class="desc">${entry.description}</div>
        </div>
      `).join('');

      const writingContainer = document.getElementById('writingContainer');
      writingContainer.innerHTML = `
        <div class="ctitle">${siteContent.writing.title}</div>
        <div>${siteContent.writing.subtitle}</div>
        <ul class="nodot">
          ${siteContent.writing.articles.map(article => 
            `<li>${article.date} <a href="${article.url}">${article.title}</a></li>`
          ).join('')}
        </ul>
        <p style="margin-top: 20px; font-size: 14px;">
          <a href="${siteContent.writing.contentLink.url}" style="color: var(--text-muted); text-decoration: none;">
            ${siteContent.writing.contentLink.text}
          </a>
        </p>
      `;

      const projectsContainer = document.getElementById('pet-projects');
      projectsContainer.innerHTML = `
        <div class="ctitle">${siteContent.projects.title}</div>
        ${siteContent.projects.items.map((project, index) => `
          <div class="project" onclick="openProjectModal(${index})">
            <div class="pico"><img src="${project.image}" style="max-width: 64px;" /></div>
            <div class="pdesc"><a href="${project.url}">${project.name}</a> ${project.description}</div>
            ${project.detailedDescription ? '<div class="project-expand-hint">Click to read more...</div>' : ''}
            <div class="pend"></div>
          </div>
        `).join('')}
      `;

      // Create modal for project details
      createProjectModal();

      const publicationsContainer = document.getElementById('publicationsContainer');
      publicationsContainer.innerHTML = `
        <div class="ctitle">${siteContent.publications.title}</div>
        ${siteContent.publications.items.map(item => `
          <div class="pub">
            <div class="pub-title">${item.url ? `<a href="${item.url}">${item.title}</a>` : item.title}</div>
            <div class="pub-venue">${item.venue}</div>
            <div class="pub-authors">${item.authors}</div>
          </div>
        `).join('')}
      `;

      const miscContainer = document.getElementById('miscContainer');
      miscContainer.innerHTML = `
        <div class="ctitle">${siteContent.misc.title}</div>
        ${siteContent.misc.items.map(item => `
          <div class="misc-item">
            <strong>${item.url ? `<a href="${item.url}" target="_blank" rel="noopener">${item.title}</a>` : item.title}</strong>
            ${item.description ? ` - ${item.description}` : ''}
          </div>
        `).join('')}
      `;

      document.getElementById('contactTitle').textContent = siteContent.contact.title;
      document.getElementById('contactDescription').textContent = siteContent.contact.description;
      document.getElementById('name').placeholder = siteContent.contact.placeholders.name;
      document.getElementById('email').placeholder = siteContent.contact.placeholders.email;
      document.getElementById('message').placeholder = siteContent.contact.placeholders.message;
      document.getElementById('submitBtn').textContent = siteContent.contact.submitButton;

      document.getElementById('footer').innerHTML = `
        ${siteContent.footer.attribution}
        <div>${siteContent.footer.tagline}</div>
      `;
    }

    loadContent();
  </script>

  <script type="text/javascript">
    document.getElementById('contactForm').addEventListener('submit', async function (e) {
      e.preventDefault();

      const submitBtn = document.getElementById('submitBtn');
      const formStatus = document.getElementById('formStatus');
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const message = document.getElementById('message').value.trim();

      formStatus.textContent = '';
      formStatus.className = '';
      formStatus.style.display = 'none';

      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!name || !email || !message) {
        formStatus.textContent = siteContent?.contact.messages.fillAllFields || 'Please fill in all fields.';
        formStatus.className = 'error';
        formStatus.style.display = 'block';
        return;
      }

      if (!emailRegex.test(email)) {
        formStatus.textContent = siteContent?.contact.messages.invalidEmail || 'Please enter a valid email address.';
        formStatus.className = 'error';
        formStatus.style.display = 'block';
        return;
      }

      submitBtn.disabled = true;
      const originalButtonText = submitBtn.textContent;
      submitBtn.textContent = siteContent?.contact.submitButtonSending || 'Sending...';

      try {
        const formData = {
          name: name,
          email: email,
          message: message
        };

        const response = await fetch('/api/contact', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(formData)
        });

        const result = await response.json();

        if (response.ok && result.success) {
          formStatus.textContent = siteContent?.contact.messages.success || "Message sent successfully! I'll get back to you soon.";
          formStatus.className = 'success';
          formStatus.style.display = 'block';
          document.getElementById('contactForm').reset();
          
          setTimeout(() => {
            formStatus.style.display = 'none';
          }, 5000);
        } else {
          throw new Error(result.error || result.message || 'Submission failed');
        }
      } catch (error) {
        formStatus.textContent = siteContent?.contact.messages.error || 'Failed to send message. Please try again or email me directly.';
        formStatus.className = 'error';
        formStatus.style.display = 'block';
        console.error('Contact form error:', error);
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = originalButtonText;
      }
    });
  </script>

  <!-- attempt hiding from spambots :p -->
  <!-- <script type="text/javascript">
    const rot13 = (message) => {
      const alpha = 'abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFGHIJKLM';
      return message.replace(/[a-z]/gi, letter => alpha[alpha.indexOf(letter) + 13]);
    }
    var e_is_shown = false;
    document.getElementById('iemail').addEventListener("click", function () {
      let demail = document.getElementById('demail');
      let msg = "naqerj.xnecngul" + "@" + "tznvy.pbz<oe>V'z fbeel ohg V trg jnl gbb zhpu rznvy naq vg vf birejuryzvat. V bayl znantr gb ercyl gb ~1% bs vg, naq vs jr qba'g xabj rnpu bgure crefbanyyl, vg vf n ybg pybfre gb 0%. Cyrnfr qba'g \"gnxr lbhe fubg\", naq fbeel :("
      demail.innerHTML = rot13(msg);
      demail.style.opacity = e_is_shown ? 0 : 1;
      e_is_shown = !e_is_shown;
    })

  </script> -->

  <script type="text/javascript">
    // Project Modal Functions
    function createProjectModal() {
      if (document.getElementById('projectModal')) return;
      
      const modal = document.createElement('div');
      modal.id = 'projectModal';
      modal.className = 'modal';
      modal.innerHTML = `
        <div class="modal-content">
          <span class="close" onclick="closeProjectModal()">&times;</span>
          <div class="modal-body">
            <div class="modal-project-header">
              <img id="modalProjectImage" src="" alt="project" class="modal-project-image" />
              <div class="modal-project-info">
                <h2 id="modalProjectName"></h2>
                <a id="modalProjectLink" href="" target="_blank" class="github-link">View on GitHub â†’</a>
              </div>
            </div>
            <div id="modalProjectDescription" class="modal-project-description"></div>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }

    function openProjectModal(index) {
      const project = siteContent.projects.items[index];
      if (!project.detailedDescription) {
        window.open(project.url, '_blank');
        return;
      }

      document.getElementById('modalProjectName').textContent = project.name;
      document.getElementById('modalProjectImage').src = project.image;
      document.getElementById('modalProjectLink').href = project.url;
      document.getElementById('modalProjectDescription').innerHTML = project.detailedDescription;
      
      document.getElementById('projectModal').style.display = 'block';
      document.body.style.overflow = 'hidden';
    }

    function closeProjectModal() {
      document.getElementById('projectModal').style.display = 'none';
      document.body.style.overflow = 'auto';
    }

    window.onclick = function(event) {
      const modal = document.getElementById('projectModal');
      if (modal && event.target == modal) {
        closeProjectModal();
      }
    }
  </script>

  <footer id="footer"
    style="text-align: center; padding: 20px 0; color: var(--text-muted); font-size: 0.9em; border-top: 1px solid var(--border-light); margin-top: 40px; transition: color 0.3s ease, border-color 0.3s ease;">
  </footer>
</body>

</html>
